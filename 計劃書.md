# OpenGameVerse 開發計劃書 (Project Development Plan)

## 1. 專案願景 (Vision)

**OpenGameVerse** 是一個追求極致效能與跨平台一致性的遊戲庫管理平台。我們利用 **.NET 10 Native AOT** 技術，移除傳統託管環境的開銷，為 Windows 與 Linux 用戶提供一個原生感強、啟動速度達到毫秒級的遊戲入口。

### 核心技術指標

* **啟動速度**: < 500ms (Cold Start)。
* **資源占用**: 靜態記憶體占用目標 < 100MB。
* **分發形式**: 單一原生二進位檔案 (Self-contained, Native AOT)，無需安裝任何 Runtime。

---

## 2. 技術棧與規範 (Tech Stack & Standards)

| 領域 | 選擇方案 | 說明 |
| --- | --- | --- |
| **Runtime** | **.NET 10** | 使用最新的 AOT 編譯特化功能 (Runtime Feature Swapping) |
| **UI 框架** | **Avalonia UI** | 跨平台渲染引擎，支援 Skia/Vulkan/DirectX |
| **編譯技術** | **Native AOT** | 全靜態編譯，禁用 JIT 與動態反射 |
| **架構模式** | **MVVM** | 配合 `CommunityToolkit.Mvvm` 原始碼生成器 |
| **資料庫** | **SQLite** | 搭配編譯時生成器處理實體映射 (Dapper.AOT 或同級方案) |
| **元數據 API** | **IGDB (Twitch)** | 遊戲資料、Cover 與藝術圖來源 |

---

## 3. 系統架構設計 (System Architecture)

### 3.1 零反射核心 (Zero-Reflection Core)

為了相容 Native AOT，OpenGameVerse 將嚴格遵循以下開發規範：

* **JSON 序列化**: 強制使用 `System.Text.Json` 的 `JsonSourceGenerationOptions`。
* **依賴注入**: 避免使用 `Microsoft.Extensions.DependencyInjection` 的運行時掃描，改用手動實例化或編譯時 DI 注入。
* **動態載入**: 由於不支援 Addon 功能，所有邏輯均在編譯時確定，以最大化編譯器優化 (Tree Shaking)。

### 3.2 跨平台適配層 (Platform Abstraction Layer)

定義 `IPlatformHost` 介面，針對不同 OS 實作：

* **Windows**:
* 使用 `Win32 API` 偵測安裝清單。
* 整合 `ShellExecute` 處理遊戲啟動。


* **Linux**:
* 解析 `/usr/share/applications/*.desktop`。
* 整合 `Flatpak` 與 `Snap` 列表指令。
* 處理 `Proton` 啟動路徑的前綴環境變數 (WINEPREFIX)。



---

## 4. 功能模組實作 (Modules)

### 4.1 掃描引擎 (Game Discovery Engine)

* **自動偵測**: 針對 Steam (`libraryfolders.vdf`)、Epic Launcher 與 GOG Galaxy 的安裝目錄進行硬編碼路徑與環境變數掃描。
* **效能優化**: 使用非同步流 (`IAsyncEnumerable`) 讀取檔案系統，避免掃描時介面卡頓。

### 4.2 Metadata 刮削器 (Metadata Scraper)

* **同步策略**:
1. 優先匹配本地 Hash/路徑名。
2. 調用 IGDB API 獲取詳細資訊。
3. 下載封面圖並利用 **ImageSharp** 進行縮放處理，存儲為高品質 WebP 格式快取。



### 4.3 現代化用戶介面 (Modern UX)

* **Desktop 模式**:
* 採用 Fluent Design (Mica/Acrylic 效果)。
* 虛擬化網格視圖 (Virtualized Grid)，確保數千款遊戲下滾動依然流暢。


* **Fullscreen 模式**:
* 專為 4K 大螢幕設計，使用 `FocusManager` 管理選取框。
* **控制器支援**: 透過 `Avalonia.Input` 直接映射手把按鍵，支援 Xbox 與 PlayStation 控制器。



---

## 5. 編譯與部署 (Build & Deployment)

### 5.1 AOT 優化配置 (`.csproj`)

```xml
<PropertyGroup>
  <PublishAot>true</PublishAot>
  <StripSymbols>true</StripSymbols>
  <StackTraceSupport>false</StackTraceSupport>
  <InvariantGlobalization>false</InvariantGlobalization>
  <OptimizationPreference>Speed</OptimizationPreference>
  <IlcGenerateCompleteTypeMetadata>false</IlcGenerateCompleteTypeMetadata>
  <IlcGenerateStackTraceData>false</IlcGenerateStackTraceData>
</PropertyGroup>

```

### 5.2 持續整合 (CI/CD)

* **GitHub Actions**:
* `ubuntu-latest` 構建 Linux 二進位檔。
* `windows-latest` 構建 Windows .exe 檔案。
* 自動執行 `AOT-Compatibility-Check` 掃描潛在的反射警告。



---

## 6. 開發里程碑 (Milestones)

1. **Phase 1 (Kernel)**: 完成 AOT 環境下的 SQLite 存取與基礎遊戲掃描邏輯。
2. **Phase 2 (UX Framework)**: 搭建 Avalonia 主視窗，實作響應式遊戲列表。
3. **Phase 3 (Metadata)**: 整合 IGDB API，實作本地圖片快取管理系統。
4. **Phase 4 (Fullscreen)**: 完成手把輸入映射與大螢幕導航介面。
5. **Phase 5 (Polishing)**: 針對 Linux 發行版 (SteamOS/Ubuntu) 的相容性微調與二進位體積縮減。

---

## 7. 專業建議：下一步行動

為了啟動 **OpenGameVerse**，建議先建立專案骨架並驗證 AOT 鏈接：

1. 建立一個 Avalonia .NET 10 專案。
2. 引入 `System.Text.Json` 並設定 Source Generator。
3. 嘗試編譯為單一 AOT 檔案並在乾淨的 Linux 環境（無 .NET Runtime）運行。
